# Описание графиков отчёта

Подробное описание каждого графика: что показывает, как считается, как интерпретировать.

---

## РАЗДЕЛ 1: Общая статистика (5 графиков)

### 1. KPI карточки
**Что показывает:** 4 ключевых показателя бизнеса
**Как считается:**
- Клиентов: `df_long['client_id'].nunique()` — уникальные ID
- Выручка: `df_long['Сумма в чеке'].sum()` — сумма всех продаж
- Средний чек: `Выручка / Число чеков`
- Всего чеков: `df_long['Число чеков'].sum()`

### 2. Выручка по годам
**Что показывает:** Столбчатая диаграмма выручки за 2023, 2024, 2025
**Как считается:** `df_long.groupby('Год')['Сумма в чеке'].sum()`
**Интерпретация:** Рост/падение бизнеса год к году

### 3. Активных клиентов по годам
**Что показывает:** Количество уникальных клиентов в каждом году
**Как считается:** `df_long.groupby('Год')['client_id'].nunique()`
**Интерпретация:** Расширение/сужение клиентской базы

### 4. Доля выручки по годам
**Что показывает:** Pie chart — процент выручки каждого года
**Как считается:** Те же данные что график 2, но в процентах
**Интерпретация:** Какой год принёс больше всего денег

### 5. Тепловая карта: Месяц × Год
**Что показывает:** Выручка по месяцам и годам (цвет = сумма)
**Как считается:** `df_long.groupby(['Год', 'Месяц'])['Сумма в чеке'].sum().pivot()`
**Интерпретация:** Сезонность, аномальные месяцы

---

## РАЗДЕЛ 2: Анализ покупателей (20+ графиков)

### 2.1 Сегментация по сумме покупок

#### 6. Распределение клиентов по сегментам
**Что показывает:** Pie chart — доля клиентов в каждом сегменте
**Сегменты (по квартилям суммы покупок):**
- **VIP**: >= 75 перцентиль (топ 25% по выручке)
- **Активный**: >= 50 перцентиль
- **Средний**: >= 25 перцентиль
- **Низкий**: < 25 перцентиль

**Как считается:**
```python
q75 = client_stats['Всего сумма'].quantile(0.75)
q50 = client_stats['Всего сумма'].quantile(0.50)
q25 = client_stats['Всего сумма'].quantile(0.25)
```

#### 7. Выручка по сегментам
**Что показывает:** Сколько денег принёс каждый сегмент
**Как считается:** `client_stats.groupby('Сегмент')['Всего сумма'].sum()`
**Интерпретация:** VIP обычно приносят 50-80% выручки при 25% клиентов (правило Парето)

#### 8. Динамика сегментов по годам
**Что показывает:** Как менялось количество клиентов в сегментах
**Как считается:** Количество уникальных клиентов по годам в каждом сегменте
**Интерпретация:** Рост VIP = хорошо, рост Низкого = плохо

#### 9. Топ-20 клиентов по выручке
**Что показывает:** 20 клиентов с максимальной суммой покупок
**Как считается:** `client_stats.nlargest(20, 'Всего сумма')`
**Интерпретация:** Ключевые клиенты для удержания

#### 10. Топ-20 клиентов по частоте
**Что показывает:** 20 клиентов с максимальным числом чеков
**Как считается:** `client_stats.nlargest(20, 'Всего чеков')`
**Интерпретация:** Самые лояльные клиенты (часто покупают)

### 2.2 Сегментация по цене товара

#### 11. Распределение по ценовым сегментам
**Что показывает:** Клиенты по средней цене покупаемого товара
**Сегменты:**
- **Премиум**: покупают дорогой товар (>= 75 перцентиль средней цены)
- **Средний+**: >= 50 перцентиль
- **Средний**: >= 25 перцентиль
- **Эконом**: < 25 перцентиль (покупают дешёвый товар)

**Как считается:**
```python
Средняя цена товара = Сумма в чеке / Количество в чеке
client_stats['Средняя цена'] = df_long.groupby('client_id')['Средняя цена товара'].mean()
```

#### 12. Цена товара vs Частота покупок (Scatter)
**Что показывает:** Связь между ценой товара и частотой покупок
**Оси:**
- X: Средняя цена товара клиента
- Y: Количество чеков
- Размер точки: Общая выручка
- Цвет: Ценовой сегмент

**Интерпретация:**
- Премиум + много чеков = идеальный клиент
- Эконом + мало чеков = слабый клиент

#### 13. Box plot цен по сегментам
**Что показывает:** Распределение средней цены внутри каждого сегмента
**Интерпретация:** Медиана, квартили, выбросы

#### 14. Выручка ценовых сегментов по годам
**Что показывает:** Stacked bar — как менялась выручка сегментов
**Интерпретация:** Рост Премиум сегмента = рост маржинальности

#### 15. Сравнение Премиум vs Эконом
**Что показывает:** Grouped bar — метрики двух крайних сегментов
**Метрики:**
- Количество клиентов
- Средняя выручка на клиента
- Среднее число чеков
- Средняя цена товара

### 2.3 Когортный анализ

#### 16-17. Матрицы миграции (Heatmap)
**Что показывает:** Как клиенты переходили между сегментами
**Как читать:**
- Строки: сегмент в начале периода
- Столбцы: сегмент в конце периода
- Диагональ: остались в своём сегменте
- Выше диагонали: даунгрейд (перешли в более дешёвый)
- Ниже диагонали: апгрейд (перешли в более дорогой)

**Как считается:**
```python
common_clients = clients_2023 & clients_2024
for client in common_clients:
    matrix[segment_2023[client], segment_2024[client]] += 1
```

#### 18. Отток по сегментам
**Что показывает:** Сколько клиентов ушло из каждого сегмента
**Как считается:** `churned = clients_year1 - clients_year2`
**Интерпретация:** Высокий отток VIP = критическая проблема

#### 19. Приток новых клиентов
**Что показывает:** В какие сегменты приходят новые клиенты
**Как считается:** `new = clients_year2 - clients_year1`
**Интерпретация:** Новые в Премиум = хорошее привлечение

#### 20, 20б, 20в. Sankey диаграммы миграции
**Что показывает:** Потоки клиентов между сегментами
**Как читать:**
- Левая колонка: сегменты в начале
- Правая колонка: сегменты в конце
- Толщина потока: количество клиентов

**Периоды:**
- 20: 2023 → 2024
- 20б: 2024 → 2025
- 20в: 2023 → 2025 (весь период)

### 2.4 Поведение покупателей

#### 21-23. Histogram распределения
**Что показывает:** Распределение клиентов по метрикам
- 21: По сумме покупок
- 22: По количеству чеков
- 23: По среднему чеку

**Интерпретация:** Форма распределения (нормальное, скошенное, бимодальное)

#### 24. Активные клиенты по месяцам
**Что показывает:** Линейный график — сколько клиентов покупало в каждом месяце
**Интерпретация:** Сезонность активности

#### 25. Сезонность активности (среднее)
**Что показывает:** Средняя активность по месяцам (все годы)
**Интерпретация:** Пики и провалы сезона

---

## РАЗДЕЛ 3: Анализ групп товаров (15 графиков)

### 3.1 Общая статистика

#### 26. Выручка по группам (с dropdown)
**Что показывает:** Горизонтальные бары — выручка каждой группы
**Dropdown фильтр:** Все годы / 2023 / 2024 / 2025
**Интерпретация:** Топ и анти-топ группы

#### 27-28. Количество и чеки по группам
**Что показывает:** Альтернативные метрики популярности групп
- 27: Количество проданных товаров
- 28: Число чеков (транзакций)

#### 29. Средняя цена по группам
**Что показывает:** Какие группы дорогие, какие дешёвые
**Как считается:** `df_long.groupby('Группа')['Средняя цена товара'].mean()`

#### 30. Топ-10 и Анти-топ-10
**Что показывает:** Лучшие и худшие группы рядом
**Интерпретация:** Фокус на развитие топов, решение по анти-топам

### 3.2 Динамика

#### 31. Динамика групп по годам
**Что показывает:** Grouped bar — выручка групп в каждом году
**Интерпретация:** Растущие и падающие группы

#### 32. Рост/падение 2023→2025
**Что показывает:** Процент изменения выручки за 2 года
**Как считается:** `(revenue_2025 - revenue_2023) / revenue_2023 * 100`
**Цвет:** Зелёный = рост, Красный = падение

#### 33. Топ-5 групп по месяцам
**Что показывает:** Линейный график — динамика лучших групп
**Интерпретация:** Сезонные паттерны лидеров

#### 34-35. Тепловые карты
- **34: Месяц × Группа** — сезонность каждой группы
- **35: Группа × Год** — тренды по годам

### 3.3 Сезонность

#### 36. Сезонность по группам (с dropdown)
**Что показывает:** Линейный график выручки по месяцам
**Dropdown:** Выбор любой группы
**Интерпретация:** Индивидуальная сезонность

#### 37. Box plot сезонности
**Что показывает:** Разброс выручки по месяцам (все группы)
**Интерпретация:** Стабильные vs волатильные месяцы

#### 38. Radar сезонности топ-5
**Что показывает:** Полярный график — профиль сезонности
**Интерпретация:** Форма = паттерн продаж в году

#### 39. Q1 vs Q4
**Что показывает:** Сравнение первого и четвёртого квартала
**Как считается:** `(Q4 - Q1) / Q1 * 100`
**Интерпретация:** Положительный = рост к концу года

#### 40. Месяц пиковых продаж
**Что показывает:** В каком месяце максимум у каждой группы
**Интерпретация:** Планирование маркетинга и запасов

---

## РАЗДЕЛ 4: Связь покупателей и групп (10 графиков)

#### 41. Группы по сегментам (с dropdown)
**Что показывает:** Какие группы покупает каждый сегмент
**Dropdown:** VIP / Активный / Средний / Низкий
**Интерпретация:** Предпочтения разных сегментов

#### 42. Heatmap Сегмент × Группа
**Что показывает:** Матрица выручки сегмент-группа
**Интерпретация:** Тёмные ячейки = сильные комбинации

#### 43-44. Топ-5 для VIP и Эконом
**Что показывает:** Любимые группы крайних сегментов
**Интерпретация:** Разница в предпочтениях

#### 45. Цена группы vs Клиенты (Scatter)
**Что показывает:** Связь цены и популярности группы
**Оси:**
- X: Средняя цена товара в группе
- Y: Количество покупателей
- Размер: Выручка

**Интерпретация:** Дорогие группы = меньше клиентов (обычно)

#### 46. Treemap
**Что показывает:** Иерархия: Сегмент → Группа → Выручка
**Как читать:** Размер прямоугольника = выручка
**Интерпретация:** Визуальная структура бизнеса

#### 47. Sunburst
**Что показывает:** Иерархия: Сегмент → Год → Группа
**Как читать:** Кольца от центра наружу
**Интерпретация:** Детализация с drill-down

#### 48. Корреляция групп
**Что показывает:** Какие группы покупают вместе
**Как считается:**
```python
client_group_binary = (client_group > 0).astype(int)  # покупал/не покупал
corr_matrix = client_group_binary.corr()
```
**Интерпретация:**
- Высокая корреляция = часто покупают вместе
- Можно использовать для cross-sell

#### 49-50. Radar профили
**Что показывает:** Полярные графики — профиль покупок сегмента по группам
- 49: Премиум клиенты
- 50: Эконом клиенты

**Как считается:** Нормализованная выручка по группам (max = 1)
**Интерпретация:** Форма = "почерк" сегмента

---

## Формулы расчёта ключевых метрик

### Средняя цена товара
```python
Средняя цена = Сумма в чеке / Количество в чеке
```

### Средний чек
```python
Средний чек = Всего сумма / Всего чеков
```

### Квартильная сегментация
```python
Q25 = data.quantile(0.25)
Q50 = data.quantile(0.50)  # медиана
Q75 = data.quantile(0.75)
```

### Отток клиентов
```python
churned = clients_period1 - clients_period2  # множества
churn_rate = len(churned) / len(clients_period1) * 100
```

### Миграция между сегментами
```python
retained = diagonal.sum() / total * 100  # остались в сегменте
upgrade = below_diagonal.sum() / total * 100  # перешли выше
downgrade = above_diagonal.sum() / total * 100  # перешли ниже
```

### Рост/падение
```python
growth_pct = (value_end - value_start) / value_start * 100
```
